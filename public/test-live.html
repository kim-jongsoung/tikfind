<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Live í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold mb-8">ğŸ¥ TikTok Live í…ŒìŠ¤íŠ¸</h1>

        <!-- ì—°ê²° ì„¤ì • -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">ì—°ê²° ì„¤ì •</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">TikTok Username (@ ì œì™¸)</label>
                    <input type="text" id="tiktok-username" placeholder="ì˜ˆ: kimjongsoung" 
                           class="w-full px-4 py-2 bg-gray-700 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-400 mt-1">í˜„ì¬ ë¼ì´ë¸Œ ë°©ì†¡ ì¤‘ì¸ TikTok ê³„ì • ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</p>
                </div>
                <div class="flex space-x-4">
                    <button id="start-btn" onclick="startLive()" 
                            class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition">
                        ğŸ”´ Live ì‹œì‘
                    </button>
                    <button id="stop-btn" onclick="stopLive()" disabled
                            class="px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition disabled:opacity-50">
                        â¹ï¸ Live ì¤‘ì§€
                    </button>
                </div>
            </div>
        </div>

        <!-- ìƒíƒœ í‘œì‹œ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-sm text-gray-400 mb-2">ì—°ê²° ìƒíƒœ</h3>
                <p id="connection-status" class="text-2xl font-bold">âš« ì˜¤í”„ë¼ì¸</p>
            </div>
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-sm text-gray-400 mb-2">ì‹œì²­ì ìˆ˜</h3>
                <p id="viewer-count" class="text-2xl font-bold">0ëª…</p>
            </div>
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-sm text-gray-400 mb-2">ì´ ë©”ì‹œì§€</h3>
                <p id="total-messages" class="text-2xl font-bold">0ê°œ</p>
            </div>
        </div>

        <!-- ì±„íŒ… ë©”ì‹œì§€ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- ì±„íŒ… -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</h2>
                <div id="chat-messages" class="h-96 overflow-y-auto space-y-2 bg-gray-900 rounded p-4">
                    <p class="text-gray-500 text-center">ì±„íŒ… ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</p>
                </div>
            </div>

            <!-- AI ì‘ë‹µ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">ğŸ¤– AI ìë™ì‘ë‹µ</h2>
                <div id="ai-responses" class="h-96 overflow-y-auto space-y-2 bg-gray-900 rounded p-4">
                    <p class="text-gray-500 text-center">AI ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</p>
                </div>
            </div>
        </div>

        <!-- ì‹ ì²­ê³¡ í -->
        <div class="bg-gray-800 rounded-lg p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">ğŸµ ì‹ ì²­ê³¡ í</h2>
            <div id="song-queue" class="space-y-2">
                <p class="text-gray-500 text-center">ì‹ ì²­ê³¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</p>
            </div>
        </div>

        <!-- ë¡œê·¸ -->
        <div class="bg-gray-800 rounded-lg p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ ì‹œìŠ¤í…œ ë¡œê·¸</h2>
            <div id="system-log" class="h-48 overflow-y-auto bg-gray-900 rounded p-4 font-mono text-xs">
                <p class="text-green-400">[ì‹œìŠ¤í…œ] í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì¤€ë¹„ ì™„ë£Œ</p>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let currentUserId = 'test-user-' + Date.now();
        let isConnected = false;

        // ë¡œê·¸ ì¶”ê°€
        function addLog(message, type = 'info') {
            const log = document.getElementById('system-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            log.innerHTML += `<p class="${colors[type]}">[${timestamp}] ${message}</p>`;
            log.scrollTop = log.scrollHeight;
        }

        // Live ì‹œì‘
        async function startLive() {
            const username = document.getElementById('tiktok-username').value.trim();
            
            if (!username) {
                alert('TikTok ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }

            addLog(`TikTok Live ì—°ê²° ì‹œë„: @${username}`, 'info');
            
            socket.emit('start-tiktok-live', {
                userId: currentUserId,
                tiktokId: username
            });

            document.getElementById('start-btn').disabled = true;
            document.getElementById('stop-btn').disabled = false;
        }

        // Live ì¤‘ì§€
        function stopLive() {
            addLog('TikTok Live ì—°ê²° ì¢…ë£Œ ìš”ì²­', 'warning');
            
            socket.emit('stop-tiktok-live', {
                userId: currentUserId
            });

            document.getElementById('start-btn').disabled = false;
            document.getElementById('stop-btn').disabled = true;
            
            document.getElementById('connection-status').textContent = 'âš« ì˜¤í”„ë¼ì¸';
            isConnected = false;
        }

        // Socket.io ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        socket.on('connect', () => {
            addLog('Socket.io ì„œë²„ ì—°ê²° ì„±ê³µ', 'success');
        });

        socket.on('live-started', (data) => {
            addLog('TikTok Live ì—°ê²° ì„±ê³µ!', 'success');
            isConnected = true;
        });

        socket.on('live-error', (data) => {
            addLog(`ì—ëŸ¬: ${data.message}`, 'error');
            alert(`ì—°ê²° ì‹¤íŒ¨: ${data.message}`);
            document.getElementById('start-btn').disabled = false;
            document.getElementById('stop-btn').disabled = true;
        });

        socket.on('live-stopped', (data) => {
            addLog('TikTok Live ì—°ê²° ì¢…ë£Œë¨', 'warning');
        });

        // ë°©ì†¡ ìƒíƒœ ì—…ë°ì´íŠ¸
        socket.on('live-status', (status) => {
            if (status.isLive) {
                document.getElementById('connection-status').textContent = 'ğŸ”´ ë°©ì†¡ ì¤‘';
            } else {
                document.getElementById('connection-status').textContent = 'âš« ì˜¤í”„ë¼ì¸';
            }
            
            document.getElementById('viewer-count').textContent = status.viewerCount + 'ëª…';
            
            if (status.stats) {
                document.getElementById('total-messages').textContent = status.stats.totalMessages + 'ê°œ';
            }
        });

        // ì±„íŒ… ë©”ì‹œì§€
        socket.on('chat-message', (data) => {
            const chatDiv = document.getElementById('chat-messages');
            const messageEl = document.createElement('div');
            messageEl.className = 'bg-gray-800 rounded p-3';
            messageEl.innerHTML = `
                <p class="font-semibold text-blue-400">@${data.username}</p>
                <p class="text-sm">${data.message}</p>
                <p class="text-xs text-gray-500">${new Date(data.timestamp).toLocaleTimeString()}</p>
            `;
            chatDiv.appendChild(messageEl);
            chatDiv.scrollTop = chatDiv.scrollHeight;
            
            addLog(`ì±„íŒ…: @${data.username}: ${data.message}`, 'info');
        });

        // AI ì‘ë‹µ
        socket.on('ai-response', (data) => {
            const aiDiv = document.getElementById('ai-responses');
            const responseEl = document.createElement('div');
            responseEl.className = 'bg-purple-900 rounded p-3';
            responseEl.innerHTML = `
                <p class="font-semibold text-purple-300">ğŸ¤– AI â†’ @${data.username}</p>
                <p class="text-sm text-gray-300">${data.response}</p>
                <p class="text-xs text-gray-500">ì–¸ì–´: ${data.language} | ${new Date(data.timestamp).toLocaleTimeString()}</p>
            `;
            aiDiv.appendChild(responseEl);
            aiDiv.scrollTop = aiDiv.scrollHeight;
            
            addLog(`AI ì‘ë‹µ [${data.language}]: ${data.response}`, 'success');
        });

        // ì‹ ì²­ê³¡ í ì—…ë°ì´íŠ¸
        socket.on('queue-update', (data) => {
            const queueDiv = document.getElementById('song-queue');
            queueDiv.innerHTML = '';
            
            if (data.queue.length === 0) {
                queueDiv.innerHTML = '<p class="text-gray-500 text-center">ì‹ ì²­ê³¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            } else {
                data.queue.forEach((item, index) => {
                    const songEl = document.createElement('div');
                    songEl.className = 'bg-gray-900 rounded p-4 flex justify-between items-center';
                    songEl.innerHTML = `
                        <div>
                            <p class="font-semibold">${index + 1}. ${item.song.artist} - ${item.song.title}</p>
                            <p class="text-sm text-gray-400">ì‹ ì²­: @${item.requester}</p>
                        </div>
                        <button onclick="removeSong(${item.id})" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">
                            ì‚­ì œ
                        </button>
                    `;
                    queueDiv.appendChild(songEl);
                });
                
                addLog(`ì‹ ì²­ê³¡ í ì—…ë°ì´íŠ¸: ${data.queue.length}ê³¡`, 'info');
            }
        });

        // ì‹ ì²­ê³¡ ì‚­ì œ
        function removeSong(songId) {
            socket.emit('remove-song', {
                userId: currentUserId,
                songId: songId
            });
        }

        socket.on('disconnect', () => {
            addLog('Socket.io ì„œë²„ ì—°ê²° ëŠê¹€', 'error');
        });
    </script>
</body>
</html>
